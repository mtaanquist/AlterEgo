@model AlterEgo.Models.ForumViewModels.ThreadsViewModel

@{
    ViewBag.Title = Model.Forum.Name;
}

<div class="row">
    <div class="col-lg-12">
        <ol class="breadcrumb">
            <li><a asp-controller="Home" asp-action="Index">Alter Ego</a></li>
            <li><a asp-controller="Forum" asp-action="Index">Forum</a></li>
            <li class="active">@Model.Forum.Category.Name</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="view-header">
            <div class="header-icon">
                <i class="pe page-header-icon pe-7s-angle-right"></i>
            </div>

            <div class="header-title">
                <h2>@Model.Forum.Name</h2>
                <small>
                    @Model.Forum.Description
                </small>
            </div>
        </div>
        <hr />
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <span class="pull-right">
            <a asp-controller="Forum" asp-action="NewThread" asp-route-id="@Model.Forum.ForumId" class="btn btn-default">Start New Thread</a>
        </span>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <table class="table table-hover table-striped">
            <thead>
                <tr>
                    <th class="col-lg-7"></th>
                    <th class="col-lg-2"></th>
                    <th class="col-lg-3"></th>
                </tr>
            </thead>
            <tbody>
            @foreach (var thread in Model.Threads.OrderByDescending(thread => thread.IsStickied).ThenByDescending(thread => thread.LatestPostTime))
            {
                <tr>
                    <td>
                        @if (thread.IsStickied) { @Html.Raw("<span class=\"label label-default\">Sticky</span>") }
                        @if (thread.IsLocked) { @Html.Raw("<span class=\"label label-default pull-right\">Locked</span>") }
                        <a asp-controller="Forum" asp-action="Thread" asp-route-id="@thread.ThreadId">@thread.Name</a><br/>
                        <small>Started by @thread.Author, at @thread.CreatedAt.ToString("g")</small>
                    </td>
                    <td>
                        <small>@thread.Posts.Count replies</small><br/>
                        <small>@thread.Views views</small>
                    </td>
                    <td class="text-right">
                        @{
                            var latestPost = thread.Posts.OrderByDescending(post => post.PostedAt).First();
                        }
                        @if (latestPost != null)
                        {
                            @latestPost.Author <a href="#" title="Go to latest post"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i></a><br/>
                            <abbr class="timeago" title="@latestPost.PostedAt.ToString("O")">@latestPost.PostedAt.ToString("g")</abbr>
                        }
                        else
                        {
                            <em>No replies found</em>
                        }
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>