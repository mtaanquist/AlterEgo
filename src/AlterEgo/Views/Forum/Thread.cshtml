@model AlterEgo.Models.ForumViewModels.ThreadViewModel

@{
    ViewBag.Title = $"{Model.Thread.Name} - {Model.Thread.Forum.Name}";
}

<div class="row">
    <div class="col-lg-12">
        <ol class="breadcrumb">
            <li><a asp-controller="Home" asp-action="Index">Alter Ego</a></li>
            <li><a asp-controller="Forum" asp-action="Index">Forum</a></li>
            <li><a asp-controller="Forum" asp-action="Threads" asp-route-id="@Model.Thread.ForumId">@Model.Thread.Forum.Category.Name</a></li>
            <li class="active">@Model.Thread.Forum.Name</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="view-header">
            <div class="header-icon">
                <i class="pe page-header-icon pe-7s-news-paper"></i>
            </div>

            <div class="header-title">
                <h2>@Model.Thread.Name</h2>
                <small>
                    Started by @Model.Thread.Author, at @Model.Thread.CreatedAt.ToString("G")
                </small>
            </div>
        </div>
        <hr />
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        @if (Model.Thread.IsLocked)
        {
            <p class="pull-right">
                <button type="button" class="btn btn-default" disabled="disabled">Thread Locked</button>
            </p>
        }
        else
        {
            <p class="pull-right">
                <a asp-controller="Forum" asp-action="NewReply" asp-route-id="@Model.Thread.ThreadId" class="btn btn-default">Post New Reply</a>
            </p>
        }
    </div>
</div>

@{
    var postCount = 1;
}
<div class="row">
    <div class="col-lg-12">
        @foreach (var post in Model.Thread.Posts.OrderBy(post => post.PostedAt))
            {
                var panelClass = "panel";
                if (post.PostedAt.Equals(Model.Thread.CreatedAt))
                {
                    panelClass += " panel-c-white";
                }
                else if (post.Author.GuildRank < 2)
                {
                    panelClass += " panel-c-info";
                }
                if (postCount % 2 != 0)
                {
                    panelClass += " panel-filled";
                }

                <div class="@Html.Raw(panelClass)" id="@Html.Raw($"post{post.PostId}")">
                    <div class="panel-heading">
                        @post.Author, at @post.PostedAt.ToString("G")
                        <span class="pull-right">
                            <a href="#@Html.Raw($"post{post.PostId}")">Post #@postCount</a>
                        </span>
                    </div>
                    <div class="panel-body">
                        @Html.Raw(post.FormattedContent)
                    </div>
                    <div class="panel-footer">
                        <button type="button" class="btn btn-sm btn-default">Quote</button>
                    </div>
                </div>

            postCount++;
        }
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <hr />
        <h4>Reply to this thread</h4>
        <form asp-controller="Forum" asp-action="NewReply" asp-antiforgery="true" role="form">
            <input asp-for="ThreadId" value="@Model.Thread.ThreadId" type="hidden" />

            <div class="form-group">
                <label asp-for="Content" class="sr-only"></label>
                <textarea asp-for="Content" class="form-control" rows="4"></textarea>
            </div>

            <div class="pull-right">
                <button type="submit" class="btn btn-default">Post Reply</button>
            </div>
        </form>
    </div>
</div>